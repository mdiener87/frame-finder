<!DOCTYPE html>
<html>
<head>
    <title>Test Filtering Logic</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>Test Filtering Logic</h1>
        
        <!-- Enhanced confidence filter -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12">
                        <h5>Confidence Filters</h5>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-2">
                            <label for="overallThreshold-1" class="form-label">Overall Confidence:</label>
                            <input type="range" class="form-range overall-threshold" id="overallThreshold-1" min="0" max="100" value="0" data-video-index="1">
                            <div class="form-text">
                                Minimum: <span id="overallThresholdValue-1">0</span>%
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-2">
                            <label for="lpipsFilter-1" class="form-label">LPIPS Score:</label>
                            <input type="range" class="form-range lpips-filter" id="lpipsFilter-1" min="0" max="100" value="0" data-video-index="1">
                            <div class="form-text">
                                Minimum: <span id="lpipsFilterValue-1">0</span>%
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-2">
                            <label for="clipFilter-1" class="form-label">CLIP Score:</label>
                            <input type="range" class="form-range clip-filter" id="clipFilter-1" min="0" max="100" value="0" data-video-index="1">
                            <div class="form-text">
                                Minimum: <span id="clipFilterValue-1">0</span>%
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="table-responsive">
            <table class="table table-striped results-table" id="resultsTable-1">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Overall Confidence</th>
                        <th>LPIPS Score</th>
                        <th>CLIP Score</th>
                        <th>Reference Image</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="table-success" 
                        data-confidence="0.656338095664978"
                        data-lpips="0.5808603763580322"
                        data-clip="0.6031063795089722">
                        <td class="timestamp" data-timestamp="0.0">0.000s</td>
                        <td class="confidence">65.63%</td>
                        <td class="lpips-score">58.09%</td>
                        <td class="clip-score">60.31%</td>
                        <td>
                            <span class="badge bg-secondary">reference.png</span>
                        </td>
                    </tr>
                    <tr class="table-warning" 
                        data-confidence="0.748888373374939"
                        data-lpips="0.6031584739685059"
                        data-clip="0.7993559837341309">
                        <td class="timestamp" data-timestamp="3.0">3.000s</td>
                        <td class="confidence">74.89%</td>
                        <td class="lpips-score">60.32%</td>
                        <td class="clip-score">79.94%</td>
                        <td>
                            <span class="badge bg-secondary">reference.png</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <p class="text-muted">
            <span id="visibleCount-1">2</span> of 2 match(es) found
        </p>
        
        <div class="mt-3">
            <button class="btn btn-primary" onclick="testFiltering()">Test Filtering</button>
            <button class="btn btn-secondary" onclick="resetFilters()">Reset Filters</button>
        </div>
    </div>

    <script>
        // Add event listeners for new filters
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for overall threshold sliders
            document.querySelectorAll('.overall-threshold').forEach(function(slider) {
                slider.addEventListener('input', function() {
                    const videoIndex = this.dataset.videoIndex;
                    document.getElementById('overallThresholdValue-' + videoIndex).textContent = this.value;
                    applyFilters(videoIndex);
                });
            });
            
            // Add event listeners for LPIPS filter sliders
            document.querySelectorAll('.lpips-filter').forEach(function(slider) {
                slider.addEventListener('input', function() {
                    const videoIndex = this.dataset.videoIndex;
                    document.getElementById('lpipsFilterValue-' + videoIndex).textContent = this.value;
                    applyFilters(videoIndex);
                });
            });
            
            // Add event listeners for CLIP filter sliders
            document.querySelectorAll('.clip-filter').forEach(function(slider) {
                slider.addEventListener('input', function() {
                    const videoIndex = this.dataset.videoIndex;
                    document.getElementById('clipFilterValue-' + videoIndex).textContent = this.value;
                    applyFilters(videoIndex);
                });
            });
        });
        
        function applyFilters(videoIndex) {
            const overallThreshold = document.getElementById('overallThreshold-' + videoIndex).value;
            const lpipsThreshold = document.getElementById('lpipsFilter-' + videoIndex).value;
            const clipThreshold = document.getElementById('clipFilter-' + videoIndex).value;
            
            const resultsTable = document.getElementById('resultsTable-' + videoIndex);
            const visibleCount = document.getElementById('visibleCount-' + videoIndex);
            
            if (!resultsTable) return;
            
            let visibleRowCount = 0;
            resultsTable.querySelectorAll('tbody tr').forEach(function(row) {
                // Skip error rows
                if (row.classList.contains('table-danger')) {
                    row.style.display = '';
                    visibleRowCount++;
                    return;
                }
                
                const overallConfidence = parseFloat(row.getAttribute('data-confidence'));
                const lpipsScore = parseFloat(row.getAttribute('data-lpips')) || 0;
                const clipScore = parseFloat(row.getAttribute('data-clip')) || 0;
                
                // Check all thresholds (convert thresholds to 0-1 scale for comparison)
                const overallThresholdDecimal = overallThreshold / 100.0;
                const lpipsThresholdDecimal = lpipsThreshold / 100.0;
                const clipThresholdDecimal = clipThreshold / 100.0;
                
                console.log(`Comparing: confidence=${overallConfidence} >= ${overallThresholdDecimal}, lpips=${lpipsScore} >= ${lpipsThresholdDecimal}, clip=${clipScore} >= ${clipThresholdDecimal}`);
                
                if (overallConfidence >= overallThresholdDecimal &&
                    lpipsScore >= lpipsThresholdDecimal &&
                    clipScore >= clipThresholdDecimal) {
                    row.style.display = '';
                    visibleRowCount++;
                    console.log("Row shown");
                } else {
                    row.style.display = 'none';
                    console.log("Row hidden");
                }
            });
            
            // Update visible count for this video
            if (visibleCount) {
                visibleCount.textContent = visibleRowCount;
            }
        }
        
        function testFiltering() {
            console.log("Testing filtering with default values (should show all rows)");
            applyFilters(1);
        }
        
        function resetFilters() {
            document.getElementById('overallThreshold-1').value = 0;
            document.getElementById('lpipsFilter-1').value = 0;
            document.getElementById('clipFilter-1').value = 0;
            document.getElementById('overallThresholdValue-1').textContent = 0;
            document.getElementById('lpipsFilterValue-1').textContent = 0;
            document.getElementById('clipFilterValue-1').textContent = 0;
            applyFilters(1);
        }
    </script>
</body>
</html>